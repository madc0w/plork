<!DOCTYPE html>
<html>
	<head>
		<title>Plork</title>
		<link rel="icon" type="image/x-icon" href="favicon.ico" />
		<!-- <link rel="stylesheet" type="text/css" href="style.css" /> -->

		<script src="2025-07-31 Milwaukee, nyc, birthdays.js"></script>
	</head>

	<script>
		const baseUrl =
			'https://plork.duckdns.org/pics%202025-07-31%20Milwaukee,%20nyc,%20birthdays';
		const urlParams = new URLSearchParams(window.location.search);
		let index = parseInt(urlParams.get('i')) || 0;
		let isTransitioning = false;

		// console.log('filenames', filenames);

		function createMediaElement(src) {
			if (src.endsWith('.mp4')) {
				return `<video controls><source src="${src}" type="video/mp4"/></video>`;
			} else {
				return `<img src="${src}" alt="Image"/>`;
			}
		}

		function updateDisplay() {
			const url = new URL(window.location);
			url.searchParams.set('i', index);
			window.history.replaceState({}, '', url);
			const src = `${baseUrl}/${filenames[index]}`;
			const html = createMediaElement(src);

			// Clear container and add new slide
			const container = document.getElementById('file-container');
			container.innerHTML = '';
			const slide = document.createElement('div');
			slide.className = 'slide';
			slide.innerHTML = html;
			container.appendChild(slide);

			// Update counter
			document.getElementById('counter').textContent = `${index + 1} / ${
				filenames.length
			}`;
		}

		function slideToImage(newIndex, direction) {
			if (isTransitioning) return;
			isTransitioning = true;

			// Disable navigation arrows
			document.getElementById('left-arrow').classList.add('disabled');
			document.getElementById('right-arrow').classList.add('disabled');

			const container = document.getElementById('file-container');
			const newSrc = `${baseUrl}/${filenames[newIndex]}`;

			// Get current slide
			const currentSlide = container.querySelector('.slide');

			// Create new slide element
			const newSlide = document.createElement('div');
			newSlide.className = 'slide';
			newSlide.innerHTML = createMediaElement(newSrc);

			// Position new slide off-screen
			if (direction === 'right') {
				newSlide.style.transform = 'translateX(100%)';
			} else {
				newSlide.style.transform = 'translateX(-100%)';
			}

			// Add new slide to container
			container.appendChild(newSlide);

			// Force reflow
			newSlide.offsetHeight;

			// Animate slides
			requestAnimationFrame(() => {
				if (currentSlide) {
					if (direction === 'right') {
						currentSlide.style.transform = 'translateX(-100%)';
					} else {
						currentSlide.style.transform = 'translateX(100%)';
					}
				}
				newSlide.style.transform = 'translateX(0)';

				// Clean up after transition
				setTimeout(() => {
					// Remove all slides except the new one
					const allSlides = container.querySelectorAll('.slide');
					allSlides.forEach((slide) => {
						if (slide !== newSlide) {
							slide.remove();
						}
					});

					isTransitioning = false;

					// Re-enable navigation arrows
					document.getElementById('left-arrow').classList.remove('disabled');
					document.getElementById('right-arrow').classList.remove('disabled');
				}, 300);
			});

			index = newIndex;

			// Update counter
			document.getElementById('counter').textContent = `${index + 1} / ${
				filenames.length
			}`;

			// Update URL
			const url = new URL(window.location);
			url.searchParams.set('i', index);
			window.history.replaceState({}, '', url);
		}

		function previousImage() {
			if (isTransitioning) return;
			const newIndex = index - 1 < 0 ? filenames.length - 1 : index - 1;
			slideToImage(newIndex, 'left');
		}

		function nextImage() {
			if (isTransitioning) return;
			const newIndex = index + 1 >= filenames.length ? 0 : index + 1;
			slideToImage(newIndex, 'right');
		}

		function downloadCurrentFile() {
			const currentFilename = filenames[index];
			const src = `${baseUrl}/${currentFilename}`;

			// Create a temporary anchor element to trigger download
			const link = document.createElement('a');
			link.href = src;
			link.download = currentFilename;
			link.target = '_blank';
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
		}

		// Keyboard navigation
		document.addEventListener('keydown', function (event) {
			if (isTransitioning) return;
			if (event.key === 'ArrowLeft') {
				previousImage();
			} else if (event.key === 'ArrowRight') {
				nextImage();
			}
		});
	</script>

	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
			background-color: #f4f4f4;
			height: 100vh;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		}

		h1 {
			color: #333;
			text-align: center;
			margin: 20px 0;
			flex-shrink: 0;
		}

		p {
			color: #666;
		}

		.main-container {
			flex: 1;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
			min-height: 0;
			margin-top: 50px;
		}

		#file-container {
			width: calc(100vw - 120px);
			height: calc(100vh - 100px);
			margin: 40px 0;
			position: relative;
			overflow: hidden;
		}

		.slide {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: transform 0.3s ease-in-out;
		}

		.slide img,
		.slide video {
			max-width: 100%;
			max-height: 100%;
			object-fit: contain;
		}

		.nav-arrow {
			position: absolute;
			top: 50%;
			transform: translateY(-50%);
			font-size: 30px;
			color: #333;
			cursor: pointer;
			user-select: none;
			padding: 10px;
			background-color: rgba(255, 255, 255, 0.8);
			border-radius: 50%;
			width: 50px;
			height: 50px;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: background-color 0.3s, opacity 0.3s;
			z-index: 10;
		}

		.nav-arrow:hover {
			background-color: rgba(255, 255, 255, 1);
		}

		.nav-arrow.disabled {
			opacity: 0.3;
			cursor: not-allowed;
			pointer-events: none;
		}

		.nav-arrow.left {
			left: 20px;
		}

		.nav-arrow.right {
			right: 20px;
		}

		.download-button {
			position: fixed;
			top: 20px;
			right: 20px;
			width: 50px;
			height: 50px;
			background: linear-gradient(
				135deg,
				rgba(255, 255, 255, 0.95),
				rgba(240, 240, 240, 0.95)
			);
			border: 2px solid rgba(200, 200, 200, 0.3);
			border-radius: 50%;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 18px;
			color: #555;
			transition: all 0.3s ease;
			z-index: 20;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		}

		.download-button:hover {
			background: linear-gradient(135deg, #4caf50, #45a049);
			color: white;
			border-color: rgba(76, 175, 80, 0.3);
			transform: scale(1.1);
			box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
		}

		.download-button:active {
			transform: scale(0.95);
			box-shadow: 0 2px 6px rgba(76, 175, 80, 0.4);
		}
	</style>

	<body onload="updateDisplay()">
		<!-- <h1>Plork</h1> -->
		<div
			id="counter"
			style="
				text-align: center;
				padding: 10px;
				font-size: 16px;
				color: #333;
				background-color: rgba(255, 255, 255, 0.9);
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				z-index: 20;
			"
		></div>
		<button
			class="download-button"
			onclick="downloadCurrentFile()"
			title="Download current file"
		>
			↓
		</button>
		<div class="main-container">
			<div class="nav-arrow left" onclick="previousImage()" id="left-arrow">
				‹
			</div>
			<div id="file-container"></div>
			<div class="nav-arrow right" onclick="nextImage()" id="right-arrow">
				›
			</div>
		</div>
	</body>
</html>
